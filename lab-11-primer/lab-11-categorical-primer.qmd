---
title: "Lab 11: Categorical Data Analysis"
format: 
  live-html:
    webr:
      packages: 
        - ggformula
        - mosaic
        - tidyverse
      repos:
        - https://projectmosaic.r-universe.dev
      resources: 
        - https://raw.githubusercontent.com/csumb-stats-ds/stat-250-lab-primers/refs/heads/main/lab-11-primer/eye-hair-color.csv
      cell-options:
        warning: true
        completion: false
execute: 
  warning: false 
  message: false
  echo: true
code-copy: true
code-overflow: wrap
toc: true
number-sections: true
number-depth: 4
css: ../styles.css
---

{{< include ../_extensions/r-wasm/live/_knitr.qmd >}} {{< include ./_extensions/r-wasm/live/_gradethis.qmd >}}

```{webr}
#| label: theme
#| include: false
#| edit: false
library(ggplot2)
theme_set(theme_light())
options(ggplot2.continuous.color = scale_color_viridis_c, 
        ggplot2.continuous.fill = scale_fill_viridis_c,
        ggplot2.discrete.color = scale_color_viridis_d,
        ggplot2.discrete.fill = scale_fill_viridis_d)
```

```{r}
#| label: setup-checkdown
#| include: false
library(checkdown)
library(ggformula)
library(mosaic)
library(tidyverse)
library(ggplot2)
theme_set(theme_light())
options(ggplot2.continuous.color = scale_color_viridis_c, 
        ggplot2.continuous.fill = scale_fill_viridis_c,
        ggplot2.discrete.color = scale_color_viridis_d,
        ggplot2.discrete.fill = scale_fill_viridis_d)
```

::: {.callout-note collapse="true"}
## Digital Accessibility

Please note that all images were created with modifications to the defaults to make them digitally accessible. If you recreate this code in another environment, your plots have different colors and backgrounds.
:::


## Getting Started

Be sure to load the packages `ggformula` and `mosaic`, using the `library()` function. Remember, you need to do this with each new Quarto document or R Session. Add the package names in each of the blanks below to load in the indicated packages.

```{webr}
#| label: setup-webr
#| exercise: ex_1
#| caption: Loading Packages
library(_________) #for graphs
library(_________) #for statistics
library(tidyverse) #for data management
```

::: {.solution exercise="ex_1"}
#### Solution

`library()` loads in packages. You need to supply the package name you need to load inside the parentheses.

```{webr}
#| exercise: ex_1
#| solution: true
library(ggformula) #for graphs
library(mosaic) #for statistics
library(tidyverse) #for data management
```
:::

```{webr}
#| exercise: ex_1
#| check: true
gradethis::grade_this_code()
```

## Hair and Eye Color

In 1974 a Statistics professor collected data on 592 randomly selected students at the University of Delaware to help the students learn about analysis of categorical data. Import the data `eye-hair-color.csv`.

```{webr}
#| label: load-data
eye_hair <- read_csv("eye-hair-color.csv", show_col_types = FALSE) #reads in the csv file
names(eye_hair)
```
<br>

### Exploratory Data Analysis
Here are the summary statistics and data visualizations we can create for categorical data.  

#### Calculate Frequency/Count
We can use the `tally()` function to find the counts/frequency of the hair and eye color of the individuals in the study. 

```{r}
#| label: example-count
#| eval: false
tally(~x , data = mydata)
```


Here is the frequency distribution for hair color in our sample. 
```{webr}
#| label: count-hair
tally(~Hair, data = eye_hair)
```


Calculate the frequency distribution of eye color in the sample:
```{webr}
#| label: count-eye
#| exercise: ex_2

```

::: {.solution exercise="ex_2"}
#### Solution

```{webr}
#| exercise: ex_2
#| solution: true
tally(~Eye, data = eye_hair)
```
:::

```{webr}
#| exercise: ex_2
#| check: true
gradethis::grade_this_code()
```



#### Calculate Relative Frequency/Proportion

We can adjust the arguments in the `tally()` function to find the proportion/relative frequency of the hair and eye color of the individuals in the study. 

```{r}
#| label: example-prop
#| eval: false
tally(~x , data = mydata, format = "prop")
```


Here is the relative frequency distribution for hair color in our sample.  
```{webr}
#| label: prop-hair
tally(~Hair, data = eye_hair, format = "prop")
```


Calculate the relative frequency distribution of eye color in the data:
```{webr}
#| label: prop-eye
#| exercise: ex_3

```

::: {.solution exercise="ex_3"}
#### Solution

```{webr}
#| exercise: ex_3
#| solution: true
tally(~Eye, data = eye_hair, format = "prop")
```
:::

```{webr}
#| exercise: ex_3
#| check: true
gradethis::grade_this_code()
```


#### Creating a Contingency Table

Suppose we want to compare the distribution of eye color across different hair colors.  We can create a contingency table using the same `tally()` function.  

```{r}
#| label: example-contingency
#| eval: false
tally(y ~ x , data = mydata) #y position are rows, x position are columns
```


Here is the frequency distribution for hair and eye color in our sample. 
```{webr}
#| label: contingency-table
tally(Eye ~ Hair, data = eye_hair)
```


#### Calculate Conditional Proportions
In order to calculate the conditional proportions, we can adjust our code a little bit to make it clear which variable we are conditioning on.  

```{r}
#| label: example-prop-cond
#| eval: false
tally(~y | x , data = mydata, format = "prop") # y conditioned on x
```


Here are the conditional proportions of hair color given eye color in our sample.  
```{webr}
#| label: cond-prop-hair-eye
tally(~ Hair | Eye, data = eye_hair, format = "prop")
```


Now calculate the conditional proportions of eye color given hair color:
```{webr}
#| label: cond-prop-eye-hair
#| exercise: ex_4

```

::: {.solution exercise="ex_4"}
#### Solution

```{webr}
#| exercise: ex_4
#| solution: true
tally(~ Eye | Hair, data = eye_hair, format = "prop")
```
:::

```{webr}
#| exercise: ex_4
#| check: true
gradethis::grade_this_code()
```


#### Bar Plots of Counts
We can choose from several options for our bar plot for a single categorical variable. 

```{r}
#| label: example-bar
#| eval: false
gf_bar(~x , data = mydata)
```


Here is the bar plot for hair color counts in our sample.  
```{webr}
#| label: bar-hair
gf_bar(~Hair, data = eye_hair, 
       xlab = "Color of Hair",
       ylab = "Number of Statistics Students at Univ. of Del. in 1974")
```


Create a bar plot for the eye color counts in the our sample:
```{webr}
#| label: bar-eye
#| exercise: ex_5

```

::: {.solution exercise="ex_5"}
#### Solution

```{webr}
#| exercise: ex_5
#| solution: true
gf_bar(~Eye, data = eye_hair, 
       xlab = "Color of Eye",
       ylab = "Number of Statistics Students at Univ. of Del. in 1974")
```
:::

```{webr}
#| exercise: ex_5
#| check: true
gradethis::grade_this_code()
```


#### Bar Plots of Proportions
We can choose from several options for our bar plot for a single categorical variable. 

```{r}
#| label: example-prop-bar
#| eval: false
gf_props(~x , data = mydata)
```


Here is the bar plot for hair color proportions in our sample.  
```{webr}
#| label: bar-hair-prop
gf_props(~Hair, data = eye_hair, 
       xlab = "Color of Hair",
       ylab = "Proportion of of Statistics Students at Univ. of Del. in 1974")
```


Create a bar plot for the eye color counts in the our sample:
```{webr}
#| label: bar-eye-prop
#| exercise: ex_6

```

::: {.solution exercise="ex_6"}
#### Solution

```{webr}
#| exercise: ex_6
#| solution: true
gf_props(~Eye, data = eye_hair, 
       xlab = "Color of Eye",
       ylab = "Proportion of Statistics Students at Univ. of Del. in 1974")
```
:::

```{webr}
#| exercise: ex_6
#| check: true
gradethis::grade_this_code()
```


#### Bar Plots of Conditional Proportions
Here is an example of a plot where we look at the conditional proportion for eye color conditioned on hair color. 

```{webr}
#| label: cond-prop-bar
gf_props(~Eye | Hair, data = eye_hair,
         fill = ~ Eye,
         xlab = "Color of Eyes",
         ylab = "Proportion of Statistics Students at Univ. of Del. in 1974") |> 
  gf_refine(scale_fill_manual(values = c("#1E90FF", "#8B4513", "#4B9B3A", "#8E6A4A")))
```
  
  
> What do you notice about how the distribution of eye color varies among those with different hair colors?  




## Comparing Eye Color Distribution from 1974 and 2025.
In 2025 a study was published using all 50 states' Department of Motor Vehicles information to identify eye and hair color for all registered individuals. They found the following:

| Eye Color | Percent |
|-----------|---------|
| Blue      | 25%     |
| Brown     | 55%     |
| Green     | 9%      |
| Hazel     | 11%     |


We want to determine if the distribution of eye color of statistics students at the University of Delaware in 1974 is similar the distribution of eye color in the United States in 2025.  
  
  
### Distribution of Blue Eye Color
Let's first practice with a simple hypothesis test to determine if the true proportion of blue eyes was  higher among statistics students at the University of Delaware in 1974 compare to the proportion of blue eyes in the US in 2025.  

#### Null Hypothesis
```{r}
#| label: null-hyp
#| echo: false
check_question(c("\U03C0 = 0.237"),
               options = c(
                 "\U03C0 = 0",
                 "\U03C0 > 0",
                 "\U03C0 < 0",
                 "\U03C0 \U2260 0",
                 "\U03C0 = 0.237",
                 "\U03C0 > 0.237",
                 "\U03C0 < 0.237",
                 "\U03C0 \U2260 0.237"),
               type = "radio")
```
<br>

#### Alternative Hypothesis
```{r}
#| label: alt
#| echo: false
check_question(c("\U03C0 > 0.237"),
               options = c(
                 "\U03C0 = 0",
                 "\U03C0 > 0",
                 "\U03C0 < 0",
                 "\U03C0 \U2260 0",
                 "\U03C0 = 0.237",
                 "\U03C0 > 0.237",
                 "\U03C0 < 0.237",
                 "\U03C0 \U2260 0.237"),
               type = "radio")
```
<br>

> Be sure you can also write the hypotheses verbally in context. Bring your answers to office hours or the CLC for review.


#### Calculate the p-value using the Binomial Distribution
Adjust the code below to calculate the correct p-value for the test using the binomial distribution.  
```{webr}
#| label: binomial
#| exercise: ex_7
#modify the code below to match the correct alternative direction  
pbinom(215, size = 592, prob = 0.237)
```

::: {.solution exercise="ex_7"}
#### Solution

```{webr}
#| exercise: ex_7
#| solution: true
1 - pbinom(215 - 1, size = 592, prob = 0.237)
```
:::

```{webr}
#| exercise: ex_7
#| check: true
gradethis::grade_this_code()
```



### Evaluate the Chi-Square Goodness-of-Fit 

#### Null Hypothesis
Now we are going to test the full hypothesis that the true proportions for the eye color for statistics students at the University of Delaware in 1974 match the current distribution of eye colors in the United States in 2025, i.e.

$$H_0: \pi_{blue} = 0.25,~\pi_{brown} = 0.55,~\pi_{green} = 0.09,~\pi_{hazel} = 0.11$$

#### Alternative Hypothesis
Reorder the values below to write out the verbal alternative hypothesis, using the same order for the expected proportions as listed in the symbolic null hypothesis. Place the population in the last position.   

```{r}
#| label: alternative-hyp
#| echo: false
check_question(answer = c("at least one of the",
                          "population proportions",
                          "of eye color",  
                          "is different than the expected values of",
                          "0.25 for blue eyes,", 
                          "0.55 for brown eyes,",
                          "0.09 for green eyes,",
                          "and 0.11 for hazel eyes",
                          "among statistics students at the University of Delaware in 1974"),
               alignment = "vertical",
               type = "in_order")
```
<br>

#### Calculate the p-value

```{webr}
#| label: chi-square
#| exercise: ex_8
xchisq.test(~_____, data = _____, p = c(0.25, 0.55, ____, 0.11)) 
#use the same order for p based on alphabetical order
```

::: {.solution exercise="ex_8"}
#### Solution

```{webr}
#| exercise: ex_8
#| solution: true
xchisq.test(~Eye, data = eye_hair, p = c(0.25, 0.55, 0.09, 0.11))
```
:::

```{webr}
#| exercise: ex_8
#| check: true
gradethis::grade_this_code()
```


#### What do we conclude from our test? 
```{r}
#| label: evaluation-of-evidence
#| echo: false
check_question(answer = c("very strong evidence against the null"),
               options = c("no evidence against the null",
                           "some evidence against the null",
                           "moderate evidence against the null",
                           "strong evidence against the null",
                           "very strong evidence against the null"),
               type = "radio")
```
<br>


### Checking Conditions for Goodness-of-Fit Test

Check all the conditions we meet in our scenario to determine if we can use the Chi-Square Distribution as a model for the null distribution and trust our calculated p-value. 

```{r}
#| label: conditions
#| echo: false
check_question(answer = c("The measurements are categorical",		
                          "Categories are mutually exclusive",	
                          "Observations are independent",
                          "No category has an expected frequency of less than 5"), 
               options = c("The measurements are categorical",		
                           "Categories are mutually exclusive",	
                           "Observations are independent",
                           "No category has an expected frequency of less than 5"), 
               type = "checkbox")
```
<br>




