---
title: "Lab 5: Two Group EDA and QQ Plot Primer"
format: 
  live-html:
    webr:
      packages: 
        - ggformula
        - mosaic
        - tidyverse
      repos:
        - https://projectmosaic.r-universe.dev
      resources: 
        - https://raw.githubusercontent.com/csumb-stats-ds/stat-250-lab-primers/refs/heads/main/lab-5-primer/nvss-births-2022.csv
        - https://raw.githubusercontent.com/csumb-stats-ds/stat-250-lab-primers/refs/heads/main/lab-5-primer/prof-ratings.csv
      cell-options:
        warning: true
        completion: false
execute: 
  warning: false 
  message: false
  echo: true
code-copy: true
code-overflow: wrap
toc: true
number-sections: true
number-depth: 4
css: ../styles.css
---

{{< include ../_extensions/r-wasm/live/_knitr.qmd >}}
{{< include ./_extensions/r-wasm/live/_gradethis.qmd >}}

```{webr}
#| label: theme
#| include: false
#| edit: false
library(ggplot2)
theme_set(theme_light())
options(ggplot2.continuous.color = scale_color_viridis_c, 
        ggplot2.continuous.fill = scale_fill_viridis_c,
        ggplot2.discrete.color = scale_color_viridis_d,
        ggplot2.discrete.fill = scale_fill_viridis_d)
```


```{r}
#| label: setup-checkdown
#| include: false
library(checkdown)
library(ggformula)
library(mosaic)
library(tidyverse)
```


::: {.callout-note collapse="true"}
## Digital Accessibility

Please note that all images were created with modifications to the defaults to make them digitally accessible. If you recreate this code in another environment, your plots have different colors and backgrounds.
:::


## Getting Started

Be sure to load the packages `ggformula` and `mosaic`, using the `library()` function. Remember, you need to do this with each new Quarto document or R Session. Add the package names in each of the blanks below to load in the indicated packages. 

```{webr}
#| label: setup-webr
#| exercise: ex_1
#| caption: Loading Packages
library(_________) #for graphs
library(_________) #for statistics
library(tidyverse) #for data management
```


::: {.solution exercise="ex_1"}

#### Solution

`library()` loads in packages. You need to supply the package name you need to load inside the parentheses.

```{webr}
#| exercise: ex_1
#| solution: true
library(ggformula) #for graphs
library(mosaic) #for statistics
library(tidyverse) #for data management
```

:::

```{webr}
#| exercise: ex_1
#| check: true
gradethis::grade_this_code()
```


 
## Sex Bias in Professor Ratings

Sex bias stems from a perceived mismatch from an expected role or characteristics based on sex. Studies have shown that men and women have unconscious sex biases against women in traditionally male-dominated fields (such as the sciences) or characteristics (such as leadership qualities). These biases often cause equally qualified women to be seen as [less likable](https://www.youtube.com/watch?v=hK0Q8b6QhDo) or [less qualified](https://blogs.scientificamerican.com/unofficial-prognosis/study-shows-gender-bias-in-science-is-real-heres-why-it-matters/) than the men. (These links are to descriptions of two well-known studies, but there are plenty of other good resources).

Researchers are interested if this sex bias exists in traditionally female-dominated jobs as well, such as teaching. Students are asked to watch a video of an animated classroom and rate the professor. Each student is randomly assigned to either of two animations; the videos are exactly the same except for the sex of the professor drawn. You have been asked to analyze the data for the researchers to determine if the female-identifying professor is rated more poorly, on a 1 to 7 scale (with 7 being the best), than the male-identifying professor. 


Run the following code chunk to read in the data and view the variable names and first 6 rows of the data.

```{webr}
#| label: read-data
bias <- read_csv("prof-ratings.csv", 
                 show_col_types = FALSE) #reads in the csv file 
head(bias)
```


### Identify Key Components of the Scenario

##### For each variable, identify whether it is the explanatory or response variable in our analysis, and the type of variable.

###### Sex:
```{r}
#| label: type-variable-sex
#| echo: false
check_question(answer = c("Explanatory","Categorical"), 
               options = c("Explanatory", "Response", 
                           "Categorical", "Numeric"), 
               type = "checkbox")
```
<br>

###### Rating:
```{r}
#| label: type-variable
#| echo: false
check_question(c("Response","Numeric"), 
               options = c("Explanatory", "Response", 
                           "Categorical", "Numeric"), 
               type = "checkbox")
```
<br>


<!-- 2. State the parameter(s) of interest in the study. -->

<!-- > $\mu_f$ = the true mean rating by students of female-identifying professors   -->
<!-- > $\mu_m$ = the true mean rating by students of male-identifying professors -->


##### Identify the *study design* of this study. 
Be sure you are able to provide a full justification.
```{r}
#| label: type-sample
#| echo: false
check_question(answer = "Independent Two Sample", 
               options = c("Independent Two Sample", 
                           "Matched Pair Sample"), 
               type = "radio")
```
<br>


##### Identify the *study type* of this study. 
Be sure you are able to provide a full justification.
```{r}
#| label: type-study
#| echo: false
check_question(answer = "Experiment", 
               options = c("Experiment", "Observational"), 
               type = "radio")
```
<br>

### Exploratory Data Analysis

##### Calculate the summary statistics for each sample. Modify the code below to calculate the summary statistics for each group. 
```{webr}
#| label: summary-stats
#| exercise: ex_2
df_stats(________ ~ ________, data = ________)
mean(________ ~ ________, data = ________)
var(________ ~ ________, data = ________)
sd(________ ~ ________, data = ________)
```

<!-- Population | $n$     | $\bar{x}$  | $s^2$      | $s$ -->
<!-- -----------|---------|------------|------------|--------- -->
<!-- **Male**   |   34    |   4.7647   |   1.0339   | 1.0168  -->
<!-- **Female** |   34    |   3.6470   |   2.4171   | 1.5547     -->


::: {.solution exercise="ex_2"}

#### Solution

```{webr}
#| exercise: ex_2
#| solution: true
df_stats(Rating ~ Sex, data = bias)
mean(Rating ~ Sex, data = bias)
var(Rating ~ Sex, data = bias)
sd(Rating ~ Sex, data = bias)
```

:::

```{webr}
#| exercise: ex_2
#| check: true
gradethis::grade_this_code()
```


#### Create a boxplot of the data by modifying the code below. 
Recall that `~`, which translates as "by" or "as a function of," lets us graph one variable split by another. (For a boxplot, a numeric variable split by a categorical variable). Be sure to add fully descriptive axis labels. Note the solution will provide its own labels, but as long as they contain similar information they are good labels!

```{webr}
#| label: boxplot
#| exercise: ex_3
gf_boxplot(________ ~ ________, data = ________, 
        ylab = "____________________", 
        xlab = "____________________") 
```


::: {.solution exercise="ex_3"}

#### Solution

```{webr}
#| exercise: ex_3
#| solution: true
gf_boxplot(Rating ~ Sex, data = bias, 
        ylab = "Rating of Professor (1-7)", 
        xlab = "Sex of the Professor") 
```

:::

```{webr}
#| exercise: ex_3
#| check: true
gradethis::grade_this_code()
```


#### Based on your boxplot, 

##### What is the approximate median rating for females?  
```{r}
#| label: median-female
#| echo: false
check_question(answer = 4, right = "correct", wrong = "not correct")
```
<br>

##### What is the approximate median rating for males?
```{r}
#| label: median-male
#| echo: false
check_question(answer = 5, right = "correct", wrong = "not correct")
```
<br>

##### Which of the following is an appropriate statistic to describe the variability (i.e. dispersion, spread) in rating of male-identifying professors?  
```{r}
#| label: variability-male
#| echo: false
check_question(answer = c("sd"), 
               options = c("mean", "median", "IQR", "sd"), 
               type = "checkbox", 
               random_answer_order = TRUE)
```
<br>

##### Which of the following is an appropriate statistic to describe the variability (i.e. dispersion, spread) in rating of female-identifying professors?  
```{r}
#| label: variability-female
#| echo: false
check_question(answer = c("IQR"), 
               options = c("mean", "median", "IQR", "sd"), 
               type = "checkbox", 
               random_answer_order = TRUE)
```
<br>
<!-- > $M_f = 4$   -->
<!-- > $M_m = 5$ -->
<!-- > More variability in female-identifying professor ratings (IQR=2.75) compared to male-identifying professor ratings (IQR=1.75)   -->

<!-- 8. Based on your *boxplot*, assess whether samples are from normal distributions. Justify your responses. (There is no right or wrong answer here. Address the key points about normal distributions.) -->

<!-- > The males distribution is Not skewed; could be normally distributed but the female distribution is left-skewed since left whisker is longer, could not be normally distributed. -->


### Assessing Normality of the Ratings by Group
Construct a Quantile-Quantile Plot (QQ Plot) to evaluate the normality of the data. Remember for two independent groups, you must look at the QQ Plot split by the group (`~ y | x` ).  

```{webr}
#| label: qqplot
#| exercise: ex_4
gf_qq(~ _________ | _________, data = _________,
      xlab = "Theoretical Z-Scores",
      ylab = "Ratings of Professors") |> 
  gf_qqline()
```


::: {.solution exercise="ex_4"}

#### Solution

```{webr}
#| exercise: ex_4
#| solution: true
gf_qq(~Rating | Sex, data = bias,
      xlab = "Theoretical Z-Scores",
      ylab = "Ratings of Professors") |> 
  gf_qqline()
```

:::

```{webr}
#| exercise: ex_4
#| check: true
gradethis::grade_this_code()
```


### Interpreting QQ Plots
Remember to completely interpret the QQ Plot, 

- **General Pattern:** Discuss the pattern compared to the 1:1 line that represents perfect normality.

- **Specifics:** Describe specific details about the pattern such as if there are any deviations, where the deviations are located along the 1:1 line, and the magnitude of the deviations.   

- **Consideration for n:** Evaluate the severity of the deviations from the 1:1 line relative to the sample size, which should be cited.  

- **Cumulative Frequency:** Discuss the cumulative frequency rate of increase of the data points/residuals relative to the 1:1 line.   


#### Based on the QQ Plot for Female Professors, evaluate the following statements and determine if the are Complete, Incomplete, or Missing.  

##### The female-identifying scores seem normally distributed as they follow along the line with no apparent outliers. 

###### General Pattern:
```{r}
#| label: qqplot-female-1.1
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Specifics:
```{r}
#| label: qqplot-female-1.2
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Consideration for n: 
```{r}
#| label: qqplot-female-1.3
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Cumulative frequency rate of increase:
```{r}
#| label: qqplot-female-1.4
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

<br>

##### The data does not follow the 1:1 line, points start above the line and then end below the line. That means there are more data points, especially on the left tail, than expected. The cumulative frequency increases too quickly.

###### General Pattern:
```{r}
#| label: qqplot-female-2.1
#| echo: false
check_question(answer = c("Complete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Specifics:
```{r}
#| label: qqplot-female-2
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Consideration for n: 
```{r}
#| label: qqplot-female-2.3
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Cumulative frequency rate of increase:
```{r}
#| label: qqplot-female-2.4
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```
<br>


##### The majority of data points in the center of the Female plot are close to the 1:1 line, but deviates at the tails. The sample size is $n=34$ so we can expect variability. This implies that the plot is mostly normally distributed. 

###### General Pattern:
```{r}
#| label: qqplot-female-3.1
#| echo: false
check_question(answer = c("Complete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Specifics:
```{r}
#| label: qqplot-female-3.2
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Consideration for n: 
```{r}
#| label: qqplot-female-3.3
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Cumulative frequency rate of increase:
```{r}
#| label: qqplot-female-3.4
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```
<br>

##### The female plot trends normally with most of the plot points trending relatively close to the 1:1 line. There is only one large deviation in the upper tail. This means the cumulative frequency rate increases.

###### General Pattern:
```{r}
#| label: qqplot-female-4.1
#| echo: false
check_question(answer = c("Complete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Specifics:
```{r}
#| label: qqplot-female-4.2
#| echo: false
check_question(answer = c("Complete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Consideration for n: 
```{r}
#| label: qqplot-female-4.3
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Cumulative frequency rate of increase:
```{r}
#| label: qqplot-female-4.4
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```
<br>


##### The center of each data group is a little skewed and does not follow the 1:1 line. There are deviations apparent, given our sample size of 34. This means that the rate of cumulative frequency increase is not relatively normal.

###### General Pattern:
```{r}
#| label: qqplot-female-5.1
#| echo: false
check_question(answer = c("Complete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Specifics:
```{r}
#| label: qqplot-female-5.2
#| echo: false
check_question(answer = c("Missing"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Consideration for n: 
```{r}
#| label: qqplot-female-5.3
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

###### Cumulative frequency rate of increase:
```{r}
#| label: qqplot-female-5.4
#| echo: false
check_question(answer = c("Incomplete"), 
               options = c("Complete", 
                           "Incomplete", 
                           "Missing"), 
               type = "select")
```

<br>


## Parents Age Gap  
A recent study found the average Homo sapiens father has always been older than the average Homo sapiens mother for 250,000 years. However, the age gap has dwindled in the last 5,000 years, largely due to mothers having children at older ages. With declining teen birth rate, rising birth rates among older women, and women pursuing higher education and careers before starting families, the average age of all mothers giving birth in the United States increased to nearly 30 in 2023. While the age gap between parents can vary greatly, it's common for fathers to be just a few years older than mothers.

The National Vital Statistics System (NVSS) is a collaborative effort between state and local governments to compile and publish reports on all vital events - births, deaths, marriages, and divorces. A random sample of 50 births in 2022 was extracted from NVSS. The data for mother's age and father's age can be found in `nvss-births-2022.csv`.

```{webr}
#| label: read-parents
parents <- read_csv("nvss-births-2022.csv", 
                    show_col_types = FALSE) #reads in the csv file 
head(parents)
```


#### For each variable, identify whether it is the explanatory or response variable in our analysis, and the type of variable.

###### Sex:
```{r}
#| label: var-type-sex-2
#| echo: false
check_question(answer = c("Explanatory","Categorical"), 
               options = c("Explanatory", "Response", 
                           "Categorical", "Numeric"), 
               type = "checkbox")
```
<br>

###### Age:
```{r}
#| label: var-type-age
#| echo: false
check_question(answer = c("Response","Numeric"), 
               options = c("Explanatory", "Response", 
                           "Categorical", "Numeric"), 
               type = "checkbox")
```
<br>


##### Identify the *study design* of this study. Be sure you are able to provide a full justification.  
```{r}
#| label: var-type-matched
#| echo: false
check_question(answer = "Matched Pair Sample", 
               options = c("Independent Two Sample", 
                           "Matched Pair Sample"), 
               type = "radio")
```
<br>


##### Identify the *study type* of this study. Be sure you are able to provide a full justification.  
```{r}
#| label: study-type-2
#| echo: false
check_question(answer = "Observational", 
               options = c("Experiment", "Observational"), 
               type = "radio")
```
<br>


#### Calculate the summary statistics for the differences. 
Modify the code below to calculate the summary statistics. We will focus on the difference between the Father's age and the Mother's age.  

```{webr}
#| label: summary-stats-matched
#| exercise: ex-5
df_stats(~(________ - ________), data = ________)
mean(~(________ - ________), data = ________)
var(~(________ - ________), data = ________)
sd(~(________ - ________), data = ________)
```

::: {.solution exercise="ex_5"}

#### Solution

```{webr}
#| exercise: ex_5
#| solution: true
df_stats(~(FatherAge - MotherAge), data = parents)
mean(~(FatherAge - MotherAge), data = parents)
var(~(FatherAge - MotherAge), data = parents)
sd(~(FatherAge - MotherAge), data = parents)
```

:::

```{webr}
#| exercise: ex_5
#| check: true
gradethis::grade_this_code()
```




#### Create a boxplot of the differences by modifying the code below. 

Be sure to add fully descriptive axis labels. As long as your axis contains similar information it is fine.

```{webr}
#| label: boxplot-matched
#| exercise: ex_6
gf_boxplot(~(________ - ________), data = ________, 
        xlab = "____________________") 
```

::: {.solution exercise="ex_6"}

#### Solution

```{webr}
#| exercise: ex_6
#| solution: true
gf_boxplot(~(FatherAge - MotherAge), data = parents,
      xlab = "Difference between Father's and Mother's Age of Newborn Infants in 2023") 
```

:::

```{webr}
#| exercise: ex_6
#| check: true
gradethis::grade_this_code()
```





### Assessing Normality of the Differences
Construct a Quantile-Quantile Plot (QQ Plot) to evaluate the normality of the differences Remember for two dependent/matched groups, you must look at the QQ Plot of the differences (`~ (x1 - x2)`). 

```{webr}
#| label: qqplot-matched
#| exercise: ex_7
gf_qq(~(________ - ________), data = ________, 
        ylab="____________________", 
        xlab="____________________") |> 
  gf_qqline()
```


::: {.solution exercise="ex_7"}

#### Solution

```{webr}
#| exercise: ex_7
#| solution: true
gf_qq(~(FatherAge - MotherAge), data = parents,
      xlab = "Theoretical Z-Scores",
      ylab = "Difference between Fahter's and Mother's Age") |> 
  gf_qqline()
```

:::

```{webr}
#| exercise: ex_7
#| check: true
gradethis::grade_this_code()
```

Practice writing a description of whether or not the differences are normally distributed based on the QQ Plot.  (Hint - it is does not meet conditions to be considered normally distributed!),

