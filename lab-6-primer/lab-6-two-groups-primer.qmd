---
title: "Lab 6: Hypothesis Testing - Two Independent Groups"
format: 
  live-html:
    webr:
      packages: 
        - ggformula
        - mosaic
        - tidyverse
      repos:
        - https://projectmosaic.r-universe.dev
      resources: 
        - https://raw.githubusercontent.com/csumb-stats-ds/stat-250-lab-primers/refs/heads/main/lab-6-primer/nvss-births-2022.csv
        - https://raw.githubusercontent.com/csumb-stats-ds/stat-250-lab-primers/refs/heads/main/lab-6-primer/prof-ratings.csv
      cell-options:
        warning: true
        completion: false
execute: 
  warning: false 
  message: false
  echo: true
code-copy: true
code-overflow: wrap
toc: true
number-sections: true
number-depth: 4
css: ../styles.css
---

{{< include ../_extensions/r-wasm/live/_knitr.qmd >}}
{{< include ./_extensions/r-wasm/live/_gradethis.qmd >}}

```{webr}
#| label: theme
#| include: false
#| edit: false
library(ggplot2)
theme_set(theme_light())
options(ggplot2.continuous.color = scale_color_viridis_c, 
        ggplot2.continuous.fill = scale_fill_viridis_c,
        ggplot2.discrete.color = scale_color_viridis_d,
        ggplot2.discrete.fill = scale_fill_viridis_d)
```


```{r}
#| label: setup-checkdown
#| include: false
library(checkdown)
library(ggformula)
library(mosaic)
library(tidyverse)
bias <- read_csv("prof-ratings.csv", 
                 show_col_types = FALSE) #reads in the csv file 
```


::: {.callout-note collapse="true"}
## Digital Accessibility

Please note that all images were created with modifications to the defaults to make them digitally accessible. If you recreate this code in another environment, your plots have different colors and backgrounds.
:::


## Getting Started

Be sure to load the packages `ggformula` and `mosaic`, using the `library()` function. Remember, you need to do this with each new Quarto document or R Session. Add the package names in each of the blanks below to load in the indicated packages. 

```{webr}
#| label: setup-webr
#| exercise: ex_1
#| caption: Loading Packages
library(_________) #for graphs
library(_________) #for statistics
library(tidyverse) #for data management
```


::: {.solution exercise="ex_1"}

#### Solution

`library()` loads in packages. You need to supply the package name you need to load inside the parentheses.

```{webr}
#| exercise: ex_1
#| solution: true
library(ggformula) #for graphs
library(mosaic) #for statistics
library(tidyverse) #for data management
```

:::

```{webr}
#| exercise: ex_1
#| check: true
gradethis::grade_this_code()
```


 
::: {.callout-tip}
## Revisit Lab 5 Primer
The examples used in the Lab 6 Primer are continuations from the [Lab 5 Primer](../lab-5-primer/lab-5-two-groups-primer.qmd). We encourage you to go back and review your previous answers and code to help you with your lab.  
:::
 
 
## Sex Bias in Professor Ratings

Sex bias stems from a perceived mismatch from an expected role or characteristics based on sex. Studies have shown that men and women have unconscious sex biases against women in traditionally male-dominated fields (such as the sciences) or characteristics (such as leadership qualities). These biases often cause equally qualified women to be seen as [less likable](https://www.youtube.com/watch?v=hK0Q8b6QhDo) or [less qualified](https://blogs.scientificamerican.com/unofficial-prognosis/study-shows-gender-bias-in-science-is-real-heres-why-it-matters/) than the men. (These links are to descriptions of two well-known studies, but there are plenty of other good resources).

Researchers are interested if this sex bias exists in traditionally female-dominated jobs as well, such as teaching. Students are asked to watch a video of an animated classroom and rate the professor. Each student is randomly assigned to either of two animations; the videos are exactly the same except for the sex of the professor drawn. You have been asked to analyze the data for the researchers to determine if the female-identifying professor is rated more poorly, on a 1 to 7 scale (with 7 being the best), than the male-identifying professor. 


Run the following code chunk to read in the data and view the variable names and first 6 rows of the data.

```{webr}
#| label: read-data
bias <- read_csv("prof-ratings.csv", 
                 show_col_types = FALSE) #reads in the csv file 
head(bias)
```


### Identify the Parameters

##### Identify the *study design* of this study. 
Be sure you are able to provide a full justification. This is review from the Lab 5 Primer.
```{r}
#| label: type-sample
#| echo: false
check_question(answer = "Independent Two Sample", 
               options = c("Independent Two Sample", 
                           "Matched Pair Sample"), 
               type = "radio")
```
<br>



##### Identify the parameter(s) that would be of interest based on the study design.  

```{r}
#| label: parameter-two
#| echo: false
check_question(answer = c("\u03BC\u2093\u2093 = true mean rating for female professor videos", 
                           "\u03BC\u2093\u1D67 = true mean rating for male professor videos"), 
               options = c("\u03BC\u2093\u2093 = true mean rating for female professor videos", 
                           "\u03BC\u2093\u1D67 = true mean rating for male professor videos",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 = true mean of the differences of the ratings between male and female professor videos",
                           "x\u0304\u2093\u2093
 = mean rating for our sample of female professor videos",
                           "x\u0304\u2093\u1D67
 = mean rating for our sample of male professor videos",
 "x\u0304\u2093\u2093\u208B\u2093\u1D67 = mean difference of the ratings between sample of male and female professor videos"), 
               type = "checkbox")
```
<br>



##### Identify the null hypothesis that would be of interest based on the study design.  
The researchers want to determine if the female-identifying professor is rated more poorly, on a 1 to 7 scale (with 7 being the best), than the male-identifying professor. (Female - Male)

```{r}
#| label: hyp-null
#| echo: false
check_question(answer = "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 = 0", 
               options = c("\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 = 0",
                           "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 < 0",
                           "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 > 0",
                           "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 \u2260 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 = 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 < 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 > 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 \u2260 0"), 
               type = "radio")
```
<br>


##### Identify the alternative hypothesis that would be of interest based on the study design.  
The researchers want to determine if the female-identifying professor is rated more poorly, on a 1 to 7 scale (with 7 being the best), than the male-identifying professor. 

```{r}
#| label: hyp-alt
#| echo: false
check_question(answer = "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 < 0", 
               options = c("\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 = 0",
                           "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 < 0",
                           "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 > 0",
                           "\u03BC\u2093\u2093 - \u03BC\u2093\u1D67 \u2260 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 = 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 < 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 > 0",
                           "\u03BC\u2093\u2093\u208B\u2093\u1D67 \u2260 0"), 
               type = "radio")
```
<br>


### Exploratory Data Analysis 
Recall from the Lab 5 Primer, we calculated the following summary statistics and data visualizations.  


#### Summary Statistics
```{r}
#| label: summary-stats-bias
df_stats(Rating ~ Sex, data = bias) 
```

#### Data Visualization
```{r}
#| label: boxplot-bias
gf_boxplot(Rating ~ Sex, data = bias, 
        ylab = "Rating of Professor in Video (Scale 1-7)", 
        xlab = "Sex of the Professor in Video") 
```

#### QQ Plot
```{r}
#| label: qqplot-bias
gf_qq(~Rating | Sex, data = bias,
      xlab = "Theoretical Z-Scores",
      ylab = "Rating of Professor in Video") |> 
  gf_qqline()
```


##### Based on the provided information, do we meet the necessary conditions to conduct inference using the t-distribution (e.g. confidence interval, hypothesis test)?  

- Remember to check the conditions of sufficient sample size and normality together.  
- The sufficient sample size depends on whether our sample indicates the population may or may not be normality distributed (now evaluated using the QQ Plot).  
- Provide a statement, based on the condition check, to determine if we can or cannot use the t-distribution as a model for null distribution or sampling distribution of our test/sample statistic.  


### Calculating the Test Statistic and P-Value

We will practice code for both a "by-hand" calculation and using `t.test()` (which is what we will be using from in general).  

For the "by-hand" calculation, we will need to split the dataset into two parts, one dataset for the male professor video ratings and one for the female professor video ratings. 

We can use the function `filter()` to extract out specific rows associated with a specific variable value.  Notice that we use double equal signs `==` to indicate equivalence with a particular value, and since our variable is a categorical (character), we put the value in quotes.  

```{webr}
#| label: filter-professor
female <- filter(bias, Sex == "Female")  #extracts ratings associated with Sex as Female
male <- filter(bias, Sex == "Male")      #extracts ratings associated with Sex as Male
```



##### Calculate the summary statistics for each sample. Modify the code below to calculate the summary statistics for each group. 

Here are the necessary summary statistics for the Female professor video Ratings. We will save them for later use. To get them to both save and print, we can add parentheses around each statement

```{webr}
#| label: summary-stats-female
(mean_f <- mean(~Rating, data = female))  #calculates sample mean for female ratings
(var_f <- var(~Rating, data = female))   #calculates sample variance for female ratings
(n_f <- length(female$Rating))           #calculates sample size for female ratings
```



Now repeat the process for the Male professor video Ratings.

```{webr}
#| label: summary-stats-male
#| exercise: ex_2
(mean_m <- _________(~________, data = ________))
(var_m <- _________(~________, data = ________))
(n_m <- _______(_______$_____))
```


::: {.solution exercise="ex_2"}

#### Solution

```{webr}
#| exercise: ex_2
#| solution: true
(mean_m <- mean(~Rating, data = male))
(var_m <- var(~Rating, data = male))
(n_m <- length(male$Rating))
```

:::

```{webr}
#| exercise: ex_2
#| check: true
gradethis::grade_this_code()
```


### Calculating a t-Test Statistic and p-Value

Now that we have the necessary summary statistics saved, we can calculate both our test statistic (t) and our p-value.  Recall the t-statistic for an independent two-sample test is  

$$t_0 = \frac{\bar{x}_1 - \bar{x}_2}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$$

Recall that we are looking at Female Ratings - Male Ratings.  Fill in the blanks below using the saved object names (e.g. `mean_f`, `var_m`) from above.  

```{webr}
#| label: test-stat
#| exercise: ex_3
(se <- sqrt(var_f/n_f + ____/____))  #calculate the standard error
(t <- (mean_f - ______)/_____)  #calculate the test statistic
```


::: {.solution exercise="ex_3"}

#### Solution

```{webr}
#| exercise: ex_3
#| solution: true
(se <- sqrt(var_f/n_f + var_m/n_m))
(t <- (mean_f - mean_m)/se)
```

:::

```{webr}
#| exercise: ex_3
#| check: true
gradethis::grade_this_code()
```


Now, calculate the p-value using the `pt()` function. Consider the direction of the alternative hypothesis.  

```{webr}
#| label: p-value
#| exercise: ex_4
pt(___________, df = n_f - ___)  #be sure to adjust to 2*pt() , 2*(1-pt()), or 1-pt() if needed
```


::: {.solution exercise="ex_4"}

#### Solution

```{webr}
#| exercise: ex_4
#| solution: true
pt(t, df = n_f - 1)
```

:::

```{webr}
#| exercise: ex_4
#| check: true
gradethis::grade_this_code()
```


Now, let's calculate the test statistic and p-value using the `t.test()` function. Consider the direction of the alternative hypothesis. Recall you have three choices for the alternative.  

- `"two.sided"`  
- `"greater"`  
- `"less"`  

```{webr}
#| label: t-test-full
#| exercise: ex_5
t.test(_______ ~ _________, data = ________, mu = __________, alternative = "________")
```


::: {.solution exercise="ex_5"}

#### Solution

```{webr}
#| exercise: ex_5
#| solution: true
t.test(Rating ~ Sex, data = bias, mu = 0, alternative = "less")
```

:::

```{webr}
#| exercise: ex_5
#| check: true
gradethis::grade_this_code()
```



#### Switching the Direction of the Difference
Ultimately, it is up to the researcher to choose the direction of the calculated difference.  If we wanted to switch our difference and have Male Ratings - Female Ratings, we would have to tell R to change the ordering of our variable using the `mutate()` function, since R defaults to reading our groups alphabetically and in the `t.test()` code would default to Female Ratings - Male Ratings (since F comes before M).  

Here is the code to reorder the variable levels so `"Male"` is read first: 
```{webr}
#| label: reorder
bias_reorder <- mutate(bias, Sex = factor(Sex, levels = c("Male", "Female")))
```


Now, rerun the `t.test()` code, but using `bias_reorder`.  What do you have to change to make the test equivalent?  

```{webr}
#| label: t-test-full-reorder
#| exercise: ex_6
t.test(_______ ~ _________, data = bias_reorder, mu = __________, alternative = "________")
```


::: {.solution exercise="ex_6"}

#### Solution

```{webr}
#| exercise: ex_6
#| solution: true
t.test(Rating ~ Sex, data = bias_reorder, mu = 0, alternative = "greater")
```

:::

```{webr}
#| exercise: ex_6
#| check: true
gradethis::grade_this_code()
```



### Interpreting and Evaluating the p-Value
Using the calculate p-value from the `t.test()` function to answer the following questions.  

##### Reorder to provide the appropriate interpretation of the p-value.
```{r}
#| label: p-value-interpretation
#| echo: false
check_question(c("There is a probability of", 
                 "0.0004447",
                 "of observing our test statistic",
                 "of t = -3.5081",
                 "or less",
                 "assuming the null hypothesis is true",
                 "that there is no difference between the true mean ratings for male and female professor videos"), 
               type = "in_order", alignment = "vertical")

```

<br>

##### Evaluate the strength of evidence against the null hypothesis, using a significance level of $\alpha = 0.05$
```{r}
#| label: evaluate-p-value
#| echo: false
check_question(answer = "very strong evidence", 
               options = c("no evidence", 
                           "little evidence",
                           "some evidence",
                           "moderate evidence",
                           "strong evidence",
                           "very strong evidence"), 
               type = "radio")
```

:::{.callout-note collapse="true"}
## Full Evaluation of Strength of Evidence
Remember we have specific details to include in a full evaluation of the strength of evidence.

*We have {very strong/strong/moderate/some/little} evidence against  the null hypothesis (in favor of the alternative hypothesis) that {context of indicated hypothesis} (t = {xxx}, df = {xxx}, p-value = {xxx})*.  
:::

<br>


##### Which of the following statements are true based on the p-value?
```{r}
#| label: p-value-meaning
#| echo: false
check_question(answer = c("our data/test statistic is very unlikely to be observed if the null is true"), 
               options = c("there is a very small probability the null is true", 
                           "our data/test statistic is very unlikely to be observed if the null is true",
                           "there is a very small probability the alternative is true",
                           "there is a very large probability the alternative is true",
                           "there is a very small probability of finding evidence against the null"), 
               type = "checkbox")
```
<br>


### Calculating a Confidence Interval for the Difference of Two Means
In order to calculate the confidence interval for the difference of two population means, it takes on the same structure as a confidence interval for one population mean.  

$$point \ estimate \pm (critical \ value)*(standard\ error)$$

or 

$$\bar{x}_1 - \bar{x}_2 \ \pm \ t^*{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}$$

We can find our $t^*$ critical value the same way we found it for previous confidence intervals.

```{webr}
#| label: cv
(cv <- qt(1-0.05/2, n_f-1))
```

Our point estimate is $\bar{x}_1 - \bar{x}_2$ 

```{webr}
#| label: point-estimate
(point_estimate <- mean_f - mean_m)
```

and finally we can calculate the lower bound (`lb`) and upper bound (`ub`) for our confidence interval.
```{webr}
#| label: conf-interval-hand
(lb_rating <- point_estimate - cv*se)
(ub_rating <- point_estimate + cv*se)
```


Of course, the "by-hand" method is tedious when we can just use `t.test()` to calculate our confidence interval.  Fill in the blanks below to calculate the 95% confidence interval for the difference between the two means.  

```{webr}
#| label: ci-ttest
#| exercise: ex_7
t.test(_______ ~ _________, data = bias, conf.level = _________)$__________
```


::: {.solution exercise="ex_7"}

#### Solution

```{webr}
#| exercise: ex_7
#| solution: true
t.test(Rating ~ Sex, data = bias, conf.level = 0.95)$conf.int
```

:::

```{webr}
#| exercise: ex_7
#| check: true
gradethis::grade_this_code()
```
<br>

##### Provide an interpretation of the confidence interval by reordering the phrases below.
```{r}
#| label: ci-interpretation
#| echo: false
check_question(c("Based on the sample", 
                 "we are 95% confident that",
                 "the difference between",
                 "the true mean rating of female professor videos",
                 "and",
                 "the true mean rating of male professor videos",
                 "is a single value",
                 "within the interval",
                 "LB and UB"), 
               type = "in_order", alignment = "vertical")
```
<br>

##### Which of the following would be plausible estimates for the difference between two true mean ratings?
```{r}
#| label: ci-plausible
#| echo: false
check_question(answer = c("-0.5", "-1", "-1.5"),
               options = c("0", "-1", "1", "-1.5", "-0.5", "0.5", "1.5", "-2", "2"), 
               type = "checkbox")
```
<br>

##### What can we conclude about the study?  
```{r}
#| label: conclusions
#| echo: false
check_question(answer = c("we can infer that the sex of the professor in the video causes ratings to be different for the videos",                         
                          "there is evidence the ratings for female professors are lower than for male professors in the videos"),
               options = c("we can infer that the sex of the professor in the video causes ratings to be different for the videos", 
                        "we cannot infer that the sex of the professor in the video causes ratings to be different for the videos", 
                        "there is evidence the ratings for female professors are lower than for male professors in the videos",
                        
                        "there is no evidence the ratings for female professors are lower than for male professors in the videos"),                        
               type = "checkbox")
```



